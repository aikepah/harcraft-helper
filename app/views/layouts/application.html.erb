<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <title><%= content_for(:title) || "Harcraft Helper" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= yield :head %>
    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">
  <%= stylesheet_link_tag :app %>
    <%= javascript_importmap_tags %>
  </head>
  <body class="min-h-screen bg-[#02111B] text-[#FCFCFC] dark:bg-[#30292F] dark:text-[#FCFCFC] flex flex-col">
    <!-- Navbar -->
    <nav class="w-full bg-[#02111B] dark:bg-[#3F4045] border-b border-[#5D737E] shadow-md fixed top-0 z-50">
      <div class="max-w-6xl mx-auto flex items-center justify-between px-4 py-3">
        <div class="flex items-center space-x-3">
          <span class="font-bold text-xl tracking-wide text-[#5D737E]">Harcraft Helper</span>
        </div>
        <button id="nav-toggle" class="md:hidden text-[#FCFCFC] focus:outline-none" aria-label="Open navigation" onclick="document.getElementById('nav-menu').classList.toggle('hidden')">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
        </button>
        <div id="nav-menu" class="hidden md:flex md:items-center md:space-x-6 w-full md:w-auto">
          <%= link_to 'Parties', parties_path, class: 'block py-2 px-3 rounded hover:bg-[#5D737E] hover:text-[#02111B] transition' %>
          <%= link_to 'Inventory', parties_path, class: 'block py-2 px-3 rounded hover:bg-[#5D737E] hover:text-[#02111B] transition' %>
          <%= link_to 'Harvesting', '#', class: 'block py-2 px-3 rounded hover:bg-[#5D737E] hover:text-[#02111B] transition' %>
          <%= link_to 'Crafting', '#', class: 'block py-2 px-3 rounded hover:bg-[#5D737E] hover:text-[#02111B] transition' %>
          <button id="dark-toggle" class="ml-4 p-2 rounded focus:outline-none border border-[#5D737E]" aria-label="Toggle dark mode">
            <svg id="dark-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path id="dark-path" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m8.66-13.66l-.71.71M4.05 19.95l-.71.71M21 12h-1M4 12H3m16.66 5.66l-.71-.71M4.05 4.05l-.71-.71M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
            </svg>
          </button>
        </div>
      </div>
    </nav>
    <!-- Flash messages -->
    <div class="mt-20 max-w-2xl mx-auto w-full px-4">
      <% flash.each do |type, msg| %>
        <div class="mb-2 px-4 py-2 rounded shadow bg-[#5D737E] text-[#02111B] dark:bg-[#30292F] dark:text-[#FCFCFC]">
          <%= msg %>
        </div>
      <% end %>
    </div>
    <!-- Main content -->
    <main class="flex-1 w-full max-w-4xl mx-auto px-4 py-8 mt-8">
      <%= yield %>
    </main>
    <!-- Footer -->
    <footer class="w-full py-4 bg-[#02111B] dark:bg-[#3F4045] text-center text-[#5D737E] text-sm border-t border-[#5D737E]">
      <span>© <%= Time.current.year %> Harcraft Helper</span> ·
      <a href="https://github.com/aikepah" target="_blank" rel="noopener" class="underline hover:text-[#FCFCFC]">GitHub</a>
    </footer>
    <script>
      // Dark mode toggle logic (wrapped in IIFE to avoid redeclaration)
      (function() {
        let darkToggle = document.getElementById('dark-toggle');
        let html = document.documentElement;
        function setDarkMode(on) {
          if (on) {
            html.classList.add('dark');
            localStorage.setItem('theme', 'dark');
          } else {
            html.classList.remove('dark');
            localStorage.setItem('theme', 'light');
          }
        }
        // On load, set theme from localStorage or OS
        const theme = localStorage.getItem('theme');
        if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          setDarkMode(true);
        } else {
          setDarkMode(false);
        }
        if (darkToggle) {
          darkToggle.onclick = function() {
            setDarkMode(!html.classList.contains('dark'));
          };
        }
      })();
    </script>
  </body>
</html>
